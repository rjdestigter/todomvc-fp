(this["webpackJsonptodomvc-fp"]=this["webpackJsonptodomvc-fp"]||[]).push([[0],{111:function(t,n,e){t.exports=e(141)},112:function(t,n,e){},116:function(t,n){},118:function(t,n){},141:function(t,n,e){"use strict";e.r(n);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));e(112);var r,c,i,a,o,u,f,p=e(1),s=e(29),b=e(7),d=e(36),l=e(9),O=e(14),j=e(12),m=e(21),h=e(35),v=e(10),E=e(22),y=e(25),g=e(11),w=e(30),k=e(31),L=e(32),x="@uri/emitter",M=function(t,n){return function(e){return p.f.fromSource(p.c.managed.chain(p.c.bracket(p.a.accessM((function(r){return p.a.sync((function(){var c=p.f.su.queueUtils(),i=c.next,a=c.ops,o=c.hasCB;return{unsubscribe:(e?r[x].addEventListener(e):r[x].fromEvent)(t)((function(t){return i({_tag:"offer",a:t}),n})),ops:a,hasCB:o}}))})),(function(t){return t.unsubscribe})),(function(t){var n=t.ops,e=t.hasCB;return p.f.su.emitter(n,e)})))}},N=Object(O.a)({},"@uri/document",document),z=p.a.provide(N),A=p.a.accessM(Object(v.flow)((function(t){return t["@uri/document"]}),p.a.pure)),P=Object(O.a)({},"@uri/dom",{createElement:function(t,n){return document.createElement(t,n)}}),T=p.a.provide(P),D=function(t){Object(w.a)(e,t);var n=Object(k.a)(e);function e(t){var r;return Object(g.a)(this,e),(r=n.call(this,"$(".concat(t,") did not return an element."))).name="ElementNotFound",r}return e}(Object(L.a)(Error)),F=function(t){Object(w.a)(e,t);var n=Object(k.a)(e);function e(t){var r;return Object(g.a)(this,e),(r=n.call(this,"Parent of node: ".concat(t," not found."))).name="ParentElementNotFound",r}return e}(Object(L.a)(Error)),q=function(t){return new D(t)},B=(Object(v.flow)(q,p.a.raiseError),function(t){return new F(t.toString())}),S=(Object(v.flow)(B,p.a.raiseError),function(t){return function(n){return j.fromNullable(n.querySelector(t))}}),U=function(t){return Object(b.pipe)(A,p.a.map(S(t)),p.a.chain(p.a.fromOption(Object(v.constant)(q(t)))))},C=function(t){return j.fromNullable(t.parentElement)},V=function(t){Object(w.a)(e,t);var n=Object(k.a)(e);function e(t){var r;return Object(g.a)(this,e),(r=n.call(this,t)).name="EmptyOptionOfElement",r}return e}(Object(L.a)(Error)),Z=(r="click",e(48)),H=Object(O.a)({},"@uri/fetch",{fetch:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return new Promise((function(t){setTimeout((function(){t(window.fetch.bind(window).apply(void 0,n))}),2e3)}))}}),J=p.a.provide(H),W=function(t){Object(w.a)(e,t);var n=Object(k.a)(e);function e(t){var r;return Object(g.a)(this,e),(r=n.call(this,"Unable to fetch: ".concat(t))).name="FetchFailed",r}return e}(Object(L.a)(Error)),$=function(t){return function(t){return new W("Fetching data from ")}},I=e(104),Q=E.e({id:E.b,userId:E.b,title:E.d,completed:E.a},"Todo"),R=E.c(Q),_=h.contramap((function(t){return t.id}))(h.eqNumber),G=Object(b.pipe)(p.d.unboundedQueue(),p.a.zip(p.e.makeRef(c?[c]:[])),p.a.chain((function(t){var n=Object(l.a)(t,2),e=n[0],r=n[1],c=function(t){return Object(b.pipe)(r.update((function(n){var e=Object(l.a)(n,1)[0];return[t(e)]})),p.a.chain((function(t){var n=Object(l.a)(t,1)[0];return e.offer(n)})))};return Object(b.pipe)(Object(I.subject)(p.f.fromSource(p.c.pure(Object(b.pipe)(e.take,p.a.map(j.some))))),p.a.map((function(t){return Object(d.a)({},t,{next:c})})))}))),K=p.a.provideM(Object(b.pipe)(G,p.a.map((function(t){return Object(O.a)({},"@uri/todo-store",t)})))),X=Object(b.pipe)(p.a.access((function(t){return t["@uri/todo-store"]}))),Y=Object(b.pipe)((i="https://jsonplaceholder.typicode.com/todos",p.a.accessM((function(t){return p.a.async((function(n){try{t["@uri/fetch"].fetch(i,a).then((function(t){return t.json()})).then(Object(v.flow)(Z.right,n))}catch(e){n(Z.left($("string"===typeof i||i.url)(e)))}return function(t){t($("string"===typeof i||i.url)(""))}}))}))),p.a.chain((function(t){return p.a.sync((function(){return R.decode(t)}))})),p.a.chain(p.a.fromEither)),tt=(o="div",p.a.accessM((function(t){return p.a.pure(t["@uri/dom"].createElement(o,u))}))),nt=Object(b.pipe)(tt,p.a.chain((function(t){return p.a.sync((function(){return t.innerHTML='<li>\n    <div class="view">\n        <input data-toggle class="toggle" type="checkbox">\n        <label data-edit></label>\n        <button data-remove class="destroy"></button>\n    </div>\n    <input class="edit" />\n</li>',S("li")(t)}))})),p.a.chain(p.a.fromOption(Object(v.constant)(q("Unable to create DOM element for todo item."))))),et=U(".todo-list"),rt=function(t){return function(n){return Object(b.pipe)(Object(y.Do)(j.option).bind("label",S("label")(n)).bind("checkbox",S("input")(n)).bind("input",S("input.edit")(n)).return((function(e){var r=e.label,c=e.checkbox,i=e.input;return p.a.sync((function(){return r.innerHTML=t.title,n.setAttribute("data-todo-id",""+t.id),t.completed&&n.classList.add("completed"),c.checked=t.completed,i.value=t.title,n}))})),p.a.fromOption(Object(v.constant)(Error(""))),p.a.chain(v.identity))}},ct=Object(b.pipe)(et,p.f.encaseEffect,p.f.chain(Object(b.pipe)(M("click"))),p.f.map((function(t){return t.target})),p.f.map(j.fromNullable),p.f.chain(p.f.fromOption),p.f.chain((function(t){var n=t,e=function(t){return Object(b.pipe)(C(t),j.chain((function(t){return C(t)})),p.a.pure,p.a.chain(p.a.fromOption(Object(v.constant)(B(t)))),p.a.map((function(t){return Object(b.pipe)(t.getAttribute("data-todo-id"),j.fromNullable,j.map(Number),j.map((function(n){return Object(v.tuple)(n,t)})))})),p.a.chain(p.a.fromOption(Object(v.constant)(B(t)))))}(n);return n.hasAttribute("data-remove")?Object(b.pipe)(e,p.a.zip(X),p.a.chain((function(t){var n=Object(l.a)(t,2),e=Object(l.a)(n[0],1)[0];return n[1].next((function(t){return t.filter((function(t){return t.id!==e}))}))})),p.f.encaseEffect):n.hasAttribute("data-toggle")?Object(b.pipe)(e,p.a.zip(X),p.a.chain((function(t){var n=Object(l.a)(t,2),e=Object(l.a)(n[0],1)[0];return n[1].next((function(t){return t.map((function(t){return t.id===e?Object(d.a)({},t,{completed:!t.completed}):t}))}))})),p.f.encaseEffect):n.hasAttribute("data-edit")?Object(b.pipe)(e,p.a.chain((function(t){var n=Object(l.a)(t,2),e=n[0],r=n[1],c=p.a.sync((function(){r.classList.add("editing")})),i=p.a.sync((function(){r.classList.remove("editing")})),a=Object(b.pipe)(r,S("input.edit"),p.a.fromOption(Object(v.constant)(q("li>input"))),p.a.chain((function(t){var n=p.a.sync((function(){t.focus(),t.select()})),r=Object(b.pipe)(t,M("blur"),p.f.take(1),p.f.drain,p.a.zip(i)),c=Object(b.pipe)(t,M("input"),p.f.chain(Object(v.constant)(Object(b.pipe)(X,p.a.chain((function(n){return n.next((function(n){return n.map((function(n){return n.id===e?Object(d.a)({},n,{title:t.value}):n}))}))})),p.f.encaseEffect))),p.f.takeUntil(r),p.f.drain);return Object(b.pipe)(n,p.a.zip(c))})));return Object(b.pipe)(c,p.a.zip(a))})),p.f.encaseEffect):p.f.encaseEffect(p.a.pure(Object(v.constVoid)()))})),p.f.drain),it=Object(b.pipe)(Y,p.a.chain((function(t){return Object(b.pipe)(X,p.a.chain((function(n){return n.next(Object(v.constant)(t))})))}))),at=p.a.Do().bind("store",X).bindL("subscription",(function(t){return t.store.subscribe})).doL((function(t){var n=t.subscription;return Object(b.pipe)(n,p.f.chain(Object(v.flow)(s.a,p.f.encaseEffect)),p.f.drain)})).return(v.constVoid),ot=[],ut=m.difference(_),ft=p.a.pure(j.none),pt=function(t){return function(n){return Object(b.pipe)(n,m.reduce(ft,(function(n,e){return Object(b.pipe)(n,p.a.chain((function(n){return Object(b.pipe)(t,S('[data-todo-id="'.concat(e.id,'"]')),j.fold(Object(v.constant)(function(t){return function(n){return function(e){return Object(b.pipe)(nt,p.a.chain(rt(e)),p.a.chainTap((function(e){return Object(b.pipe)(n,j.fold(Object(v.constant)(p.a.sync((function(){return t.prepend(e)}))),(function(t){return p.a.sync((function(){return t.after(e)}))})))})))}}}(t)(n)(e)),rt(e)),p.a.map(j.some))})))})))}},st=p.a.Do().bind("store",X).bindL("subscription",(function(t){return t.store.subscribe})).bind("ul",et).doL((function(t){var n=t.subscription,e=t.ul;return Object(b.pipe)(n,p.f.map(m.takeLeft(10)),p.f.scan(Object(v.tuple)(ot,ot),(function(t,n){var e=Object(l.a)(t,1)[0];return Object(v.tuple)(n,e)})),p.f.chain((function(t){var n,r=Object(l.a)(t,2),c=r[0],i=r[1];return p.f.encaseEffect(Object(b.pipe)((n=ut(i,c),Object(b.pipe)(n,m.map((function(t){return Object(b.pipe)(U('[data-todo-id="'.concat(t.id,'"]')),p.a.chain((function(t){return p.a.sync(t.remove.bind(t))})))})),m.readonlyArray.sequence(p.a.effect))),p.a.zip(pt(e)(c))))})),p.f.drain)})).return(v.constVoid),bt=Object(b.pipe)(p.a.parZip(p.a.parZip(at,p.a.parZip(it,ct)),st),K),dt=Object(b.pipe)(bt,T,z,J,s.b,p.a.provide((f=document,Object(O.a)({},x,{fromEvent:function(t){return function(n){return f.addEventListener(t,(function(t){return t.stopPropagation(),n(t)})),p.a.sync((function(){return f.removeEventListener(t,n)}))}},addEventListener:function(t){return function(n){return function(e){return t.addEventListener(n,(function(t){return t.stopPropagation(),e(t)})),p.a.sync((function(){return t.removeEventListener(n,e)}))}}}}))));p.a.runToPromise(dt).then((function(t){return console.log("Done",t)})).catch((function(t){console.error(t)})),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[111,1,2]]]);
//# sourceMappingURL=main.1e2b3609.chunk.js.map